<!DOCTYPE html><html lang="zh-CN">  <head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    <meta name="viewport" content="width=device-width, initial-scale=1.0">     <title></title>    <script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>    <script src="http://test.eshicon.org/KJ-PROJECT/js/jquery-2.1.0.js"></script>    <script src="http://test.eshicon.org/KJ-PROJECT/js/jquery.mobile-1.4.3.js"></script>    <!-- // <script src="http://test.eshicon.org/KJ-PROJECT/js/read-csv.js"></script> -->    <script src="./html-fileapi-master/js/read-csv.js"></script>    <link rel="stylesheet" href="http://test.eshicon.org/KJ-PROJECT/css/jquery.mobile-1.4.3.css" />    <script>    "use strict"//登录检测与跳转        $(document).on("pagebeforecreate",function(event){          if (localStorage.id != undefined && localStorage.nickname != undefined && localStorage.username != undefined){            console.log("已登录");          }else{            console.log("跳转到登录界面");            window.location.assign("http://test.eshicon.org/login.html");          };        });     </script>    <script>    "use strict";      $(function(){//定义标记          var is_connected = 0; //是否连接消息服务器          var identification = ""; //用户识别码          // window.csv_result;          // window.csv_result = new Array();          var pointer; //上传CSV的时候用到的对象指针          window.csvdata;          window.csvdata = new Object();          //读取pervious页面的#hash                    function get_anchor(){  //后退的场合              switch (location.hash)            {              case "#tools":                return "#mission";                break;              case "#message":                return "#mission";                break;              case "#additem_self":                return "#additem_self"; //不翻页                break;              case "#additem_other":                return "#additem_other";  //不翻页                break;              case "#input_csv":                return "#input_csv"; //不翻页                break;              case "#filter_setting":                return "#tools";                break;              case "#about":                return "#tools";                break;              case "":                return "#mission";                break;              default:      //未在此定义的页面都不翻页                return location.hash;                break;              }; //switch ending          };//手势前进 && 后退            document.addEventListener("touchstart", handleTouchEvent, false);            document.addEventListener("touchend", handleTouchEvent, false);            document.addEventListener("touchmove", handleTouchEvent, false);            var pre = new Array();            var end = new Array();             var delta = new Array();//对于这三个数组,[0]->x,[1]->y            var is_turning = 0;            $("#shift_to_message").on("swipe",function(){ //特别为#mission的导航栏添加滑动翻页功能              $.mobile.changePage("#message",{                  transition: "slide",                  reverse: false,                  changeHash: true                });            });            function turnpage(){              if (delta[0]>10 && Math.abs(delta[1]<10)) {                is_turning = 1;                                $.mobile.changePage(get_anchor(),{                  transition: "slide",                  reverse: true,                  changeHash: true                });                              };                          };//function turnpage() ending                          function handleTouchEvent(event) {                if (event.touches.length == 1) {                    switch (event.type) {                        case "touchstart":                            is_turning = 0;                            pre[0] = event.touches[0].clientX;                            pre[1] = event.touches[0].clientY;                            break;                        case "touchend":                            break;                        case "touchmove":                            // event.preventDefault(); //阻止滚动                            end[0] = event.changedTouches[0].clientX;                            end[1] = event.changedTouches[0].clientY;                            if (is_turning == 0) {     //若页面非正在跳转,则计算delta,翻页                              delta[0]= -(pre[0]-end[0]);                              delta[1] = pre[1]-end[1];                              turnpage();                                                }; //if ending                            break;                                                }; //switch ening                }; //if ending            }; //handleTouchEvent() ending//消息机能            // $("#link_start").click(function(){              var socket = io.connect("http://157.7.138.169:2333");              socket.on("connect", function () {                                $("#recived_message").append($('<li><center>######连接成功######<center></li>'));                // $("#recived_message").listview("refresh");                $("#connect_flag").empty().append("消息(已连接)");                is_connected = 1;                                  socket.on("main_message_client", function(message) {                  $("#recived_message").append($("<li></li>").text(message));                }); //socket.on("main_message", function(message) ending                                socket.on("main_csv_submit_client", function(result) {                  // console.log("csv上传的结果是"+result);                  if (result == -1) {                    console.log("服务器异变!上传失败!出现未知错误!");                  }else if (result == 0) {                    console.log("数据库里已有此数据");                  }else {                    console.log("编号为"+result+"的item上传成功");                  };                });                socket.on("disconnect", function() {                  $("#recived_message").append("<br><hr><br><li>连接异常关闭</li>");                  alert("与服务器的连接已关闭.刷新页面以重新连接.");                  $("#connect_flag").empty().append("消息(连接已断开)"); //这里以后加上一个消息计数器                }); //socket.on("disconnect", function() ending              });              $("#sent_message").keypress(function(event) {                if(event.which == 13) {                  event.preventDefault();                  socket.emit("main_message_server",localStorage.nickname+":"+$("#sent_message").val());                  $("#recived_message").append($("<li></li>").text(localStorage.nickname+":"+$("#sent_message").val()));                  $("#recived_message").listview("refresh");                  $("#sent_message").val("");                }; //if ending              }); //$("#sent_message").keypress(function(event) ending              $("#button_message_send").click(function(){                socket.emit("main_message_server",localStorage.nickname+":"+$("#sent_message").val());                $("#recived_message").append($("<li></li>").text(localStorage.nickname+":"+$("#sent_message").val()));                $("#recived_message").listview("refresh");                $("#sent_message").val("");              }); //$("#button_message_send").click(function() ending            // }); //$("#link_start").click() ending//清除消息按钮            $("#button_message_clear").click(function(){              $("#recived_message").empty();              $("#recived_message").append($("<li><center><h1>对话消息</h1></center></li>"));                            if (is_connected) {                $("#recived_message").append($('<li><center>######连接成功######<center></li>'));              };                            $("#recived_message").listview("refresh");            }); //$("#button_message_clear").click() ending    //重置表单            $("#reset_in_addtiem_self").click(function(){               var is_reset=confirm("你确定要重置这个表单？");                if (is_reset==true){                  form_additem_self.reset()                }            });            $("#reset_in_addtiem_other").click(function(){               var is_reset=confirm("你确定要重置这个表单？");                if (is_reset==true){                  form_additem_other.reset()                }            });//CSV上传            $("#upload_csv").click(function(){              console.log("开始可怕的循环上传");              for (pointer in window.csvdata) {               socket.emit("main_csv_submit_server",window.csvdata[pointer]);              };             // socket.emit("main_csv_check_server",1);            });      }); //$(function) ending                    </script>    </head><body><div data-role="page" id="mission">  <div data-role="header" data-position="fixed" >    <h1>任务</h1>      <div data-role="button" class="ui-btn-right">        <a href="#tools" data-role="button" data-icon="grid" data-transition="slide">工具</a>      </div>          <div data-role="button" class="ui-btn-left">        <a href="#" data-role="button" data-icon="refresh">刷新</a>      </div>  </div>  <div data-role="content">      <div data-role="collapsible" data-collapsed="false">      <h4>未完成的任务<span class="ui-li-count">33</span></h4>        <ul id="unfinished" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="在未完成的任务中搜索...">            <li><a href="#">手机                    <p>作者:Mikoto</p>                    <p>摊位:Mikoto's home</p>                    <p>价格:RMB 4000</p>                    <p>代购人:mikoto</p></a></li>            <li><a href="#">Angela                    <p>作者:Mikoto</p>                    <p>摊位:Mikoto's home</p>                    <p>价格:RMB 4000</p>                    <p>代购人:mikoto</p></a></li>            <li><a href="#">Bill                    <p>作者:Mikoto</p>                    <p>摊位:Mikoto's home</p>                    <p>价格:RMB 4000</p>                    <p>代购人:mikoto</p></a></li>        </ul>    </div>    <div data-role="collapsible">      <h4>已完成的任务<span class="ui-li-count">3</span></h4>        <ul id="finished" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="在已完成的任务中搜索...">            <li><a href="#">手机                    <p>作者:Mikoto</p>                    <p>摊位:Mikoto's home</p>                    <p>价格:RMB 4000</p>                    <p>代购人:mikoto</p></a></li>            <li><a href="#">Angela                    <p>作者:Mikoto</p>                    <p>摊位:Mikoto's home</p>                    <p>价格:RMB 4000</p>                    <p>代购人:mikoto</p></a></li>            <li><a href="#">Bill                    <p>作者:Mikoto</p>                    <p>摊位:Mikoto's home</p>                    <p>价格:RMB 4000</p>                    <p>代购人:mikoto</p></a></li>                     </ul>      </div>    </div>  <div data-role="footer" data-position="fixed">    <div data-role="navbar" id="shift_to_message">      <ul>        <li><a href="#" data-icon="info" class="ui-state-persist">任务</a></li>        <li><a href="#message" data-icon="star" data-transition="fade" ><span class="ui-li-count">233</span>消息</a></li>      </ul>    </div>  </div></div><div data-role="page" id="message">  <div data-role="header">    <h1 id="connect_flag">消息</h1>     <!-- <div data-role="button" class="ui-btn-right"> -->      <!-- <input type="button" id="link_start" value="连接" data-role="button" data-icon="check"> -->    <!-- </div> -->    <div data-role="button" class="ui-btn-left">      <input type="button" id="button_message_clear" value="清除" data-role="button" data-icon="alert">    </div>  </div>        <div data-role="content">        <br>    <ul id="recived_message" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="搜索消息记录...">      <li>        <center>          <h1>对话消息</h1>        </center>      </li>    </ul>    <br>    <label for="outgingChatMessage">输入:</label>    <input type="text" id="sent_message">    <!-- <label for="nickname">昵称:以后从本地存储的ID读取,不设置昵称输入</label> -->    <!-- <input type="text" id="nickname" value=""> -->    <input type="button" id="button_message_send" value="发送消息">    <br>      </div>  <div data-role="footer" data-position="fixed">    <div data-role="navbar" id="shift_to_mission">      <ul>        <li><a href="#mission" data-icon="info" data-transition="fade">任务</a></li>        <li><a href="#" data-icon="star" class="ui-state-persist">消息</a></li>      </ul>    </div>  </div></div><div data-role="page" id="tools">	<div data-role="header">	   <h1>工具</h1>	    <a href="#mission" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>      <a href="#login" data-role="button" data-icon="minus">退出当前帐号</a>	</div>	<div data-role="content">      <a href="#filter_setting" data-role="button" data-rel="dialog">过滤设置</a>      <a href="#" data-role="button">战完结算</a>      <a href="#about" data-role="button" data-transition="slide">关于</a>      <br><hr><br>      <a href="#additem_self" data-role="button" data-transition="slide">为自己登录宝物</a>      <a href="#additem_other" data-role="button" data-transition="slide">为他人登录宝物</a>      <a href="#input_csv" data-role="button" data-transition="slide">导入CSV文件</a>      	</div></div><div data-role="page" id="additem_self">  <div data-role="header">    <h1>为自己登录宝物</h1>     <a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>    <div data-role="button" class="ui-btn-right">      <input type="button" id="reset_in_addtiem_self" value="重置" data-role="button" data-icon="alert">    </div>  </div>        <div data-role="content">    <form method="get" action="" id="form_additem_self">        <fieldset data-role="fieldcontain">          <label for="days_in_additem_self">宝物何日参展:</label>            <select name="days_in_additem_self" id="days_in_additem_self" data-native-menu="false">             <option value="1">第一天 X曜日</option>             <option value="2">第二天 X曜日</option>             <option value="3">第三天 X曜日</option>            </select>        </fieldset>        <div data-role="fieldcontain">          <label for="name">宝物:</label>          <input type="text" name="text" id="item_self_name" value="" placeholder="宝物的名字">        </div>        <div data-role="fieldcontain">          <label for="name">价格:</label>          <input type="text" name="text" id="item_self_price" value="" placeholder="円/份">        </div>        <div data-role="fieldcontain">          <label for="name">摊位:</label>          <input type="text" name="text" id="item_self_palce" value="" placeholder="宝物的摊位号">        </div>        <div data-role="fieldcontain">          <label for="name">作者:</label>          <input type="text" name="text" id="item_self_author" value="" placeholder="作者的名字">        </div>        <div data-role="fieldcontain">          <label for="name">宝物URL:</label>          <input type="text" name="text" id="item_self_url" value="" placeholder="宝物的URL">        </div>        <div data-role="fieldcontain">          <label for="item_self_copy_number">份数:</label>          <input type="range" name="item_self_copy_number" id="item_self_copy_number" value="1" min="1" max="15">        </div>    </form>  </div>  <div data-role="footer">    <div data-role="navbar">      <ul>        <li><a href="#tools" data-icon="arrow-l" class="ui-btn">提交并返回</a></li>      </ul>    </div>  </div></div> <div data-role="page" id="filter_setting">  <div data-role="header">    <h1>过滤设置</h1>   </div>        <div data-role="content"><center>工事中</center>  </div>  <div data-role="footer" data-position="fixed">    <div data-role="navbar">      <ul>        <li><a href="#" data-icon="info" class="ui-btn"></a></li>      </ul>    </div>  </div></div><div data-role="page" id="additem_other">  <div data-role="header">    <h1>为他人登录宝物</h1>    <a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>    <div data-role="button" class="ui-btn-right">      <input type="button" id="reset_in_additem_other" value="重置" data-role="button" data-icon="alert" class="ui-btn-right">    </div>  </div>        <div data-role="content">    <form method="get" action="" id="form_additem_other">        <fieldset data-role="fieldcontain">          <label for="days_in_additem_other">宝物何日参展:</label>            <select name="days_in_additem_other" id="days_in_additem_other" data-native-menu="false">             <option value="1">第一天 X曜日</option>             <option value="2">第二天 X曜日</option>             <option value="3">第三天 X曜日</option>            </select>        </fieldset>        <div data-role="fieldcontain">          <label for="name">宝物名:</label>          <input type="text" name="text" id="item_other_name" value="" placeholder="宝物的名字">        </div>        <div data-role="fieldcontain">          <label for="name">价格:</label>          <input type="text" name="text" id="item_other_price" value="" placeholder="円/份">        </div>        <div data-role="fieldcontain">          <label for="name">摊位:</label>          <input type="text" name="text" id="item_other_place" value="" placeholder="宝物的摊位号">        </div>                <div data-role="fieldcontain">          <label for="name">作者:</label>          <input type="text" name="text" id="item_other_author" value="" placeholder="作者的名字">        </div>        <div data-role="fieldcontain">          <label for="name">宝物URL:</label>          <input type="text" name="text" id="item_other_url" value="" placeholder="宝物的URL">        </div>        <!-- <form method="post" action=""> -->          <fieldset data-role="fieldcontain">          <label for="user">代购此宝物的用户:</label>            <select name="user" id="user" data-native-menu="false">             <option value="mon">lala</option>             <option value="tue">suica</option>             <option value="wed">baka</option>             <option value="thu">9</option>             <!-- 这里作为动态页面进行更新 -->            </select>          </fieldset>        <!-- </form> -->        <!-- <form method="post" action="#"> -->            <div data-role="fieldcontain">              <label for="points">份数:</label>              <input type="range" name="points" id="item_other_copy_num" value="1" min="1" max="30">            </div>        <!-- </form> -->  </div>  <div data-role="footer">    <div data-role="navbar">      <ul>        <li><a href="#tools" data-icon="arrow-l" class="ui-btn">提交并返回</a></li>      </ul>    </div>  </div></div><div data-role="page" id="input_csv">  <div data-role="header">    <h1>导入CSV</h1>    <a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>    <div data-role="button" class="ui-btn-right">      <input type="button" id="reset_in_input_csv" value="重置" data-role="button" data-icon="alert" class="ui-btn-right">    </div>  </div>        <div data-role="content">      <fieldset>        <label for="csvFileInput"> <strong>CSV File:</strong>        </label>        <input type="file" id="csvFileInput" onchange="handleFiles(this.files)" accept=".csv">      </fieldset>      <center>～上传之前请删除color和header等无用字段,删除末尾空行.以记事本打开，另存为UTF-8编码上传，否则乱码</center>      <center>～仅支持chrome for windows～</center>        <hr><center>这里显示读取结果~debug用</center>  </div>  <div data-role="footer" data-position="fixed">    <div data-role="navbar">      <ul>        <li><a data-icon="arrow-l" class="ui-btn" id="upload_csv">确认上传并返回</a></li>      </ul>    </div>  </div></div><div data-role="page" id="about">  <div data-role="header">   <h1>关于</h1>    <div data-role="button" class="ui-btn-left">      <a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>    </div>    </div>  <div data-role="content">   <center> ver 0.62</center>   <br><hr><br><br><br>   <center>code by</center>   <center> lala && suica</center>   <br><br><br><br><br><hr>   <center>限于版权原因,无法免费提供web catalog图片加载服务</center>  </div></div></body></html>