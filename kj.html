<!DOCTYPE html>
<html lang="zh-CN">

	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0">

		<title></title>

		<!--<script src="https://cdn.socket.io/socket.io-1.0.6.js"></script>-->
		<script src="http://test.eshicon.org/KJ-PROJECT/js/socket.io-1.0.6.js"></script>
		<script src="http://test.eshicon.org/KJ-PROJECT/js/jquery-2.1.0.js"></script>
		<script src="http://test.eshicon.org/KJ-PROJECT/js/jquery.mobile-1.4.3.js"></script>
		<script src="http://test.eshicon.org/KJ-PROJECT/js/read-csv.js"></script>

		<link rel="stylesheet" href="http://test.eshicon.org/KJ-PROJECT/css/jquery.mobile-1.4.3.css" />
		<link rel="shortcut icon" type="iamge/x-icon" href="favicon.ico">
		<link rel="icon" type="image/x-icon" href="favicon.ico">
		<link rel="apple-touch-icon" href="favicon.ico">

		<style>
			div.scroll {
				overflow: auto;
				/*这个的作用是让溢出的<li><div></div></li>能够滑动,不至于在手机上看不全消息*/
			}
		</style>

		<script>
			"use strict"

			$(document).on("pageshow", "#select_group", function() {
				is_turning = 0;
			});

			$(function() {

				"use strict"

				//未登录跳转
				if (localStorage.id != undefined && localStorage.nickname != undefined && localStorage.username != undefined) {
					console.log("已登录");
				} else {
					console.log("跳转到登录界面");
					// window.location.assign("http://test.eshicon.org/login.html");
				};

				//输出活跃队伍名
				if (localStorage.active_group) {
					$("#mission_title").text(localStorage.active_group);
				} else {
					$("#mission_title").text("未选择活跃队伍");
				};

				//定义标记
				var is_connected = 0; //是否连接消息服务器
				var identification = ""; //用户识别码
				var same = 0;
				var error = 0;
				window.csvdata;
				window.csvdata = new Array();

				//读取pervious页面的#hash

				function get_anchor() { //后退的场合

					switch (location.hash) {
						case "#tools":
							return "#mission";
							break;

						case "#message":
							return "#message";
							break;

						case "#input_csv":
							return "#input_csv"; //不翻页
							break;

						case "#calc_setting":
							return "#tools";
							break;

						case "#about":
							return "#tools";
							break;

						case "":
							return "#mission";
							break;

						default: //未在此定义的页面都不翻页
							return location.hash;
							break;
					}; //switch ending

				};

				//手势前进 && 后退

				document.addEventListener("touchstart", handleTouchEvent, false);
				document.addEventListener("touchend", handleTouchEvent, false);
				document.addEventListener("touchmove", handleTouchEvent, false);

				var pre = new Array();
				var end = new Array();
				var delta = new Array(); //对于这三个数组,[0]->x,[1]->y
				window.is_turning = 0;


				$("#shift_to_message").on("swipeleft", function() { //特别为#mission的导航栏添加滑动翻页功能
					$.mobile.changePage("#message", {
						transition: "slide",
						reverse: false,
						changeHash: true
					});
				});

				$("#shift_to_mission").on("swiperight", function() { //特别为#mission的导航栏添加滑动翻页功能
					$.mobile.changePage("#mission", {
						transition: "slide",
						reverse: true,
						changeHash: true
					});
				});

				function turnpage() {

					if (delta[0] > 10 && Math.abs(delta[1] < 10)) {
						is_turning = 1;

						$.mobile.changePage(get_anchor(), {
							transition: "slide",
							reverse: true,
							changeHash: true
						});
					};

				}; //function turnpage() ending

				function handleTouchEvent(event) {

					if (event.touches.length == 1) {

						switch (event.type) {
							case "touchstart":
								is_turning = 0;
								pre[0] = event.touches[0].clientX;
								pre[1] = event.touches[0].clientY;
								break;
							case "touchend":
								break;
							case "touchmove":
								// event.preventDefault(); //阻止滚动
								end[0] = event.changedTouches[0].clientX;
								end[1] = event.changedTouches[0].clientY;
								if (is_turning == 0) { //若页面非正在跳转,则计算delta,翻页
									delta[0] = -(pre[0] - end[0]);
									delta[1] = pre[1] - end[1];
									turnpage();
								}; //if ending
								break;
						}; //switch ening
					}; //if ending
				}; //handleTouchEvent() ending


				//结算时的数据存储,绑定为全局对象
				window.calc_data = new Object();
				window.calc_data = {
					"spend_count": 0,
					"income_count": 0,
					"outcome_count": 0,
				};

				//读取物品详情/编辑关系,绑定至window作为全局对象
				window.op_details = new Object();
				window.op_details = {

					"otherinfo": new Object(), //存储对于circleid的relation;调用方式:window.op_details.otherinfo[circleid],为0则不存在item,不为0则存在item
					"now_circleid": "",
					"member": "",
					"read": function(circleid) {
						$("#circle_details_circledata").empty();
						window.op_details.now_circleid = circleid;
						window.op_details.now_circledata = window.op_details[circleid];

						for (var x in window.op_details[circleid]) {
							$("#circle_details_circledata").append("<li><div class=\"scroll\">" + x + ":" + window.op_details.now_circledata[x] + "</div></li>");
						};

						$("#circle_details").page();

						$("#circle_details_responsibility").empty().append('<option value=\"\">请选择负责人</option>');

						for (var x in window.op_details.member) {
							if (x != "item_name" && x != "item_price" && x != "circle_id") {
								if (x == window.op_details.now_circledata['responsibility']) {
									$("#circle_details_responsibility").append('<option value=\"' + x + '\" selected>' + x + '</option>');
								} else {
									$("#circle_details_responsibility").append('<option value=\"' + x + '\">' + x + '</option>');
								};
							};
						};

						if (localStorage.active_group_power == "leader") {
							$("#circle_details_responsibility").selectmenu("enable").selectmenu("refresh");
						} else {
							$("#circle_details_responsibility").selectmenu("disable").selectmenu("refresh");
						};


						$("#circle_details_circledata").listview("refresh");

						if (localStorage.nickname == window.op_details.now_circledata['responsibility']) { //是负责人则true
							$("#circle_details_set_finished").button("enable");
							if (window.op_details.now_circledata['i27'] != "finished") {
								$("#circle_details_set_finished").val("设为已完成").button("refresh");
							} else {
								$("#circle_details_set_finished").val("设为未完成").button("refresh");
							};
						} else {
							$("#circle_details_set_finished").button("disable");
						};

						$.mobile.changePage("#circle_details");
					}
				};

				//读取circle的item数据,绑定为全局对象
				window.op_items = new Object();
				window.op_items = {
					"now_circleid": "", //存储item对应的circleid,与op_detail的不混用
					"now_itemname": "",//存储item edit中对应的item name
					"clear_selectmemu": function() {
						$("#items_edit").page();
						$("#items_for_select").val("").selectmenu("refresh");
						$("#user_for_select").val("").selectmenu("refresh");
					},
					"read": function(circleid) {
						if (window.op_details.otherinfo) {
							window.op_items.now_circleid = circleid;
							$("#items_list").empty();
							$("#items_for_select").empty().append('<option value=\"\">item名</option>');
							$("#user_for_select").empty().append('<option value=\"\">user名</option>');

							var username_temp = new Object();
							for (var x in window.op_details.otherinfo[circleid]) {
								var count_items = 0; //总件数计数器
								$("#items_for_select").append('<option value=\"' + x + '\">' + window.op_details.otherinfo[circleid][x]["item_name"] + '</option>');
								$("#items_list").append('<li data-role=\"list-divider\">' + window.op_details.otherinfo[circleid][x]["item_name"] + '(' + window.op_details.otherinfo[circleid][x]["item_price"] + '円)</li>');
								for (var y in window.op_details.otherinfo[circleid][x]) { //循环读取这个item中的对象
									if (y != "circle_id" && y != "item_name" && y != "item_price" && window.op_details.otherinfo[circleid][x][y]) {
										if (!username_temp[y]) {
											$("#user_for_select").append('<option value=\"' + y + '\">' + y + '</option>');
											username_temp[y] = 1;
										};
										var temp = eval('(' + window.op_details.otherinfo[circleid][x][y] + ')');
										count_items += temp['target'];
										$("#items_list").append('<li data-role=\"listview\"><div class=\"scroll\">' + y + window.op_details.otherinfo[circleid][x][y] + '</div></li>'); //stop
									};
								};
								$("#items_list").append('<li data-role=\"listview\"><div class=\"scroll\">共' + count_items + '份</div></li>'); //stop
							};

							$("#items").page();
							$("#items_list").listview("refresh");
							$.mobile.changePage("#items");
						} else {
							alert("此circle没有任何item,请添加后查看");
						};
					},
				};

				//队伍操作,绑定为全局对象
				window.op_group = new Object();
				window.op_group = {
					raw_all_group: new Array(),
					all_group: new Array(),
					my_group: new Array(),
					other_group: new Array(),
					now_group: "",
					now_group_power: "",
					add: function() {
						if ($("#manage_group_add_group_name").val() && $("#manage_group_add_group_introduction").val() && $("#manage_group_add_group_password").val()) {
							var new_group_data = new Object();
							new_group_data = {
								"group_name": $("#manage_group_add_group_name").val(),
								"group_introduction": $("#manage_group_add_group_introduction").val(),
								"group_password": $("#manage_group_add_group_password").val()
							};
							socket.emit("main_manage_group_add_server", new_group_data, localStorage.nickname);
						} else {
							alert("三项信息都不能为空");
						};
					},
					details: function(group_name) {
						window.op_group.now_group = group_name;
						$("#group_members").empty().append("<li><center><h1>队伍成员</h1></center></li>");
						for (var i in window.op_group.raw_all_group) {
							if (window.op_group.raw_all_group[i]["group_name"] == group_name) {
								$("#group_details_change_group_name").val(group_name);
								$("#group_details_change_group_password").val("");
								$("#group_details_change_group_introduction").val(window.op_group.raw_all_group[i]["group_introduction"]);
								$("#group_details_change_group_my_power").val(window.op_group.raw_all_group[i][localStorage.nickname]);
								$("#group_details").page();

								window.op_group.now_group_power = window.op_group.raw_all_group[i][localStorage.nickname];

								switch (window.op_group.raw_all_group[i][localStorage.nickname]) {

									case "leader":
										$("#group_details_change_group_name").removeAttr("readonly");
										$("#group_details_change_group_password").removeAttr("readonly");
										$("#group_details_change_group_introduction").removeAttr("readonly");
										$("#group_details_save").button("enable");
										$("#button_active_group").button("enable");
										$("#button_join_group").button("disable");
										$("#button_exit_group").button("disable");
										$("#button_delete_group").button("enable");
										break;

									case "member":
										$("#group_details_change_group_name").attr("readonly", true);
										$("#group_details_change_group_password").attr("readonly", true);
										$("#group_details_change_group_introduction").attr("readonly", true);
										$("#group_details_save").button("disable");
										$("#button_active_group").button("enable");
										$("#button_join_group").button("disable");
										$("#button_exit_group").button("enable");
										$("#button_delete_group").button("disable");
										break;

									case null:
										$("#group_details_change_group_name").attr("readonly", true);
										$("#group_details_change_group_password").removeAttr("readonly");
										$("#group_details_change_group_introduction").attr("readonly", true);
										$("#group_details_save").button("disable");
										$("#button_active_group").button("disable");
										$("#button_join_group").button("enable");
										$("#button_exit_group").button("disable");
										$("#button_delete_group").button("disable");
										break;
								};
							};
							if (window.op_group.raw_all_group[i]["group_name"] == window.op_group.now_group) {
								for (var x in window.op_group.raw_all_group[i]) {
									if (x != "group_introduction" && x != "group_name" && window.op_group.raw_all_group[i][x] != null) {
										if (window.op_group.raw_all_group[i][x] == "leader") {
											$("#group_members").prepend("<li><div class=\"scroll\"><center>" + x + "</center></div></li>");
											$("#group_members").prepend("<li><center><h1>队长</h1></center></li>");
										} else if (window.op_group.raw_all_group[i][x] == "member") {
											$("#group_members").append("<li><div class=\"scroll\"><center>" + x + "</center></li>");
										};
									};
								};
							};
						};

						if (window.op_group.now_group == localStorage.active_group) {
							$("#button_active_group").button("disable").val("已设为活跃").button("refresh");
						} else {
							$("#button_active_group").val("设为活跃").button("refresh");
						};
						$("#group_members").listview("refresh");
						$.mobile.changePage("#group_details");
					},

				};
				//通讯机能

				var socket = io.connect("http://157.7.138.169:2333");

				socket.on("connect", function() {

					is_connected = 1;

					$("#recived_message").append("<li><center>连接成功<center></li>");

					$("#message").page(); //review的时候查一下这个page()是啥用的
					$("#recived_message").listview("refresh");

					$("#connect_flag").empty().append("消息(已连接)");

					socket.on("main_message_client", function(message) {
						$("#recived_message").append("<li><div class=\"scroll\">" + message + "</div></li>");
						$("#unread_message_count").text(Number($("#unread_message_count").text()) + 1);
					}); //socket.on("main_message", function(message) ending

					socket.on("main_csv_submit_client", function(result) {
						if (result == -1) {
							$("#upload_result").apped("<li><center>服务器异变!请联系suica</center></li>");
							error++;
						} else if (result == 0) {
							$("#upload_result").append("<li><center>数据库已有此宝物的数据</center></li>");
							same++;
						} else {
							$("#upload_result").append("<li><center>编号为" + result + "的Circle上传成功</center></li>");
						};
						$("#upload_result").listview("refresh");
					});
					//任务推送
//对应修改点4
					socket.on("main_mission_list_client", function(otherinfo, circleinfo,is_other) {
						if (is_other == 0) {//push to unfinished or finished
							if (!window.op_details.member) {
								window.op_details.member = otherinfo;
							};
							var pureobj_myinfo = eval('(' + otherinfo[localStorage.nickname] + ')'); //转换之后,格式变成了pureobj_otherinfo={bought:0,target: 1} 其中,1/0都是number类型
							
							if (circleinfo['i27'] != "finished" && circleinfo['responsibility'] == localStorage.nickname) {
								if (!$.isArray(window.op_details.otherinfo[circleinfo['i2']])) { //若不是数组,则初始化为数组
									window.op_details.otherinfo[circleinfo['i2']] = new Array();
								};
								window.op_details.otherinfo[circleinfo['i2']].push(otherinfo);
								if ($("#" + circleinfo['i2']).length > 0) { //存在此元素
								} else {
									$("#unfinished").append('<li><a herf="#circle_details" onclick="window.op_details.read(' + circleinfo['i2'] + ')" id=\"' + circleinfo['i2'] + '\">' + circleinfo['i14'] //标题自动变大
										+ '<p>' + circleinfo['i11'] + ' </p><p>ID:' + circleinfo['i2'] + '</p>' + '<p>作者:' + circleinfo['i13'] + '</p>' + '<p>摊位:' + circleinfo['i6'] + '-' + circleinfo['i7'] + '-' + circleinfo['i8'] + '-' + circleinfo['i9'] + '-' + circleinfo['i22'] + '</p>' + '<p>备注:' + circleinfo['i17'] + '</p>' + '<p>负责人:' + circleinfo['responsibility'] + '</p>' + '<a onclick=\"window.op_items.read(' + circleinfo['i2'] + ')\">' + '</a>' + '</li>');

									$("#unfinished").listview("refresh");
									$("#unfinished_count").text(Number($("#unfinished_count").text()) + 1);
									window.op_details[circleinfo['i2']] = circleinfo;
								};
							} else if (circleinfo['i27'] == "finished" && circleinfo['responsibility'] == localStorage.nickname) {
								if (!$.isArray(window.op_details.otherinfo[circleinfo['i2']])) { //若不是数组,则初始化为数组
									window.op_details.otherinfo[circleinfo['i2']] = new Array();
								};
								window.op_details.otherinfo[circleinfo['i2']].push(otherinfo);
								if ($("#" + circleinfo['i2']).length > 0) { //存在此元素
								} else {
									$("#finished").append('<li><a herf="#circle_details" onclick="window.op_details.read(' + circleinfo['i2'] + ')" id=\"' + circleinfo['i2'] + '\">' + circleinfo['i14'] //标题自动变大
										+ '<p>' + circleinfo['i11'] + ' ID:' + circleinfo['i2'] + '</p>' + '<p>作者:' + circleinfo['i13'] + '</p>' + '<p>摊位:' + circleinfo['i6'] + '-' + circleinfo['i7'] + '-' + circleinfo['i8'] + '-' + circleinfo['i9'] + '-' + circleinfo['i22'] + '</p>' + '<p>备注:' + circleinfo['i17'] + '</p>' + '<p>负责人:' + circleinfo['responsibility'] + '</p>' + '</p></a><a onclick=\"window.op_items.read(' + circleinfo['i2'] + ')\">' + '</a></li>');

									$("#finished").listview("refresh");
									$("#finished_count").text(Number($("#finished_count").text()) + 1);
									window.op_details[circleinfo['i2']] = circleinfo;
								};
							};

						} else { //is_other = 1,push to "other mission"
							if ($("#" + circleinfo['i2']).length > 0) { //存在此元素
							} else { //不存在此元素
								$("#all_mission").append('<li><a herf="#circle_details" onclick="window.op_details.read(' + circleinfo['i2'] + ')">' + circleinfo['i14'] + '<p>' + circleinfo['i11'] + ' ID:' + circleinfo['i2'] + '</p>' + '<p>作者:' + circleinfo['i13'] + '</p>' + '<p>摊位:' + circleinfo['i6'] + '-' + circleinfo['i7'] + '-' + circleinfo['i8'] + '-' + circleinfo['i9'] + '-' + circleinfo['i22'] + '</p>' + '<p>备注:' + circleinfo['i17'] + '</p>' + '<p>负责人:' + circleinfo['responsibility'] + '</p></a><a onclick=\"window.op_items.read(' + circleinfo['i2'] + ')\">' + '</a></li>');
								$("#all_mission").listview("refresh");
								$("#all_count").text(Number($("#all_count").text()) + 1);
								window.op_details[circleinfo['i2']] = circleinfo;
								window.op_details.otherinfo[circleinfo['i2']] = 0; //为空则记作0
							};
						};
					});
//修改点4结束
					//输出结算结果
					socket.on("main_calc_client", function(iteminfo, otherinfo) {
						var pureobj_myinfo = eval('(' + otherinfo[localStorage.nickname] + ')');
						// var names = new Array();
						var pureobj_everyinfo = new Object();
						if (window.calc_data.date == "233" || window.calc_data.date == iteminfo['i6']) {
							for (var x in otherinfo) { //筛出要收入和钱和要付出的钱进行处理
								if (x != "i2" && x != "rowid" && otherinfo[x] && x != localStorage.nickname) { //有意义的用户名
									pureobj_everyinfo[x] = eval('(' + otherinfo[x] + ')');
									if (pureobj_everyinfo[x]['finish'] == 1 && pureobj_myinfo['finish'] == 1) {
										$("#calc_result_details").page(); //防止找不到refresh方法
										if (pureobj_myinfo['whobuy'] == localStorage.nickname && pureobj_everyinfo[x]['whobuy'] == localStorage.nickname) {
											console.log("用户" + x + "给自机的已完成的委托" + iteminfo['i2']);
											//进income,确认价格和对方的入手数量
											$("#calc_result_income").append('<li><div class="scroll">' + '「' + iteminfo['i14'] + '」' + '<p>' + iteminfo['i11'] + ' ID:' + iteminfo['i2'] + '</p>' + '<p>作者:' + iteminfo['i13'] + '</p>' + '<p>指定购买人:' + localStorage.nickname + '</p>' + '<p>目标数量:' + pureobj_myinfo['target'] + '</p>' + '<p>有效结算数量(对方入手数量):' + pureobj_everyinfo[x]['bought'] + '</p>' + '<p>价格(円):' + iteminfo['i27'] + '</p>' + '</div></li>');
											$("#calc_result_income_simple").append('<li><div class="scroll">应从' + x + '拿到' + Number(iteminfo['i27']) * Number(pureobj_everyinfo[x]['bought']) + '円,' + 'ID:' + iteminfo['i2'] + ',' + '「' + iteminfo['i14'] + '」' + '单价' + iteminfo['i27'] + '円,' + '共' + pureobj_myinfo['bought'] + '份' + '</div></li>');
											$("#calc_result_income").listview("refresh");
											$("#calc_result_income_simple").listview("refresh");
											window.calc_data.income_count += Number(iteminfo['i27']) * Number(pureobj_everyinfo[x]['bought']);
											$("#calc_result_income_count").text("应付小计:" + window.calc_data.income_count + "円");

										} else if (pureobj_myinfo['whobuy'] == x && pureobj_everyinfo[x]['whobuy'] == x) {
											// 扔进outcome,确认价格和自己的入手数量
											console.log("自机让用户" + x + "买的已完成的委托" + iteminfo['i2']);
											$("#calc_result_outcome").append('<li><div class="scroll">' + '「' + iteminfo['i14'] + '」' + '<p>' + iteminfo['i11'] + ' ID:' + iteminfo['i2'] + '</p>' + '<p>作者:' + iteminfo['i13'] + '</p>' + '<p>指定购买人:' + pureobj_myinfo['whobuy'] + '</p>' + '<p>目标数量:' + pureobj_myinfo['target'] + '</p>' + '<p>有效结算数量(自身入手数量):' + pureobj_myinfo['bought'] + '</p>' + '<p>价格(円):' + iteminfo['i27'] + '</p>' + '</div></li>');
											$("#calc_result_outcome_simple").append('<li><div class=\"scroll\">应付给' + x + Number(iteminfo['i27']) * Number(pureobj_myinfo['bought']) + '円,' + 'ID:' + iteminfo['i2'] + ',' + '「' + iteminfo['i14'] + '」' + '单价' + iteminfo['i27'] + '円,' + '共' + pureobj_myinfo['bought'] + '份' + '</div></li>');
											$("#calc_result_outcome").listview("refresh");
											$("#calc_result_outcome_simple").listview("refresh");
											window.calc_data.outcome_count += Number(iteminfo['i27']) * Number(pureobj_myinfo['bought']);
											$("#calc_result_outcome_count").text("应付小计:" + window.calc_data.outcome_count + "円");
										};
									};
								};
							};

							if (pureobj_myinfo['whobuy'] == localStorage.nickname) {
								console.log("自机消费" + iteminfo['i2']);
								$("#calc_result_spend").append('<li><div class="scroll">' + '「' + iteminfo['i14'] + '」' + '<p>' + iteminfo['i11'] + ' ID:' + iteminfo['i2'] + '</p>' + '<p>作者:' + iteminfo['i13'] + '</p>' + '<p>指定购买人:' + pureobj_myinfo['whobuy'] + '</p>' + '<p>目标数量:' + pureobj_myinfo['target'] + '</p>' + '<p>有效结算数量(自身入手数量):' + pureobj_myinfo['bought'] + '</p>' + '<p>价格(円):' + iteminfo['i27'] + '</p>' + '</div></li>');
								$("#calc_result_spend_simple").append('<li><div class="scroll">消费' + Number(iteminfo['i27']) * Number(pureobj_myinfo['bought']) + '円,' + 'ID:' + iteminfo['i2'] + ',' + '「' + iteminfo['i14'] + '」' + '单价' + iteminfo['i27'] + '円,' + '共' + pureobj_myinfo['bought'] + '份' + '</div></li>');
								$("#calc_result_spend").listview("refresh");
								$("#calc_result_spend_simple").listview("refresh");
								window.calc_data.spend_count += Number(iteminfo['i27']) * Number(pureobj_myinfo['bought']);
								$("#calc_result_spend_count").text("应付小计:" + window.calc_data.spend_count + "円");

							};
						}; // if 判断日期 ending

					});
					//队伍推送
					socket.on("main_select_group_client", function(result) {
						window.op_group.raw_all_group.push(result);
						window.op_group.all_group.push({
							"group_name": result['group_name'],
							"group_introduction": result['group_introduction'],
							"my_power": result[localStorage.nickname]
						});
						if (result[localStorage.nickname]) {

							window.op_group["my_group"].push({
								"group_name": result["group_name"],

								"group_introduction": result["group_introduction"],
								"my_power": result[localStorage.nickname]
							});

							$("#recived_group").append("<li><a onclick=\"window.op_group.details(\'" + result["group_name"] + "\')\">" + result["group_name"] + "(" + result[localStorage.nickname] + ")" + "<p>" + result["group_introduction"] + "</p>" + "</a></li>");
						} else {
							window.op_group["other_group"].push({
								"group_name": result["group_name"],
								"my_power": ""
							});
							$("#recived_group").append("<li><a onclick=\"window.op_group.details(\'" + result["group_name"] + "\')\">" + result["group_name"] + "(未加入此队伍)" + "<p>" + result["group_introduction"] + "</p>" + "</a></li>");
						};

						$("#select_group").page();
						$("#recived_group").listview("refresh");

						if (!is_turning) {
							$.mobile.changePage("#select_group");
							is_turning = 1;
							// console.log(is_turning);
						};

					}); //socket.on("main_select_group_client") ending

					socket.on("alert_client", function(text_number, type_number) {
						if (type_number == 1) {
							switch (text_number) {
								case 1:
									alert("加入此队伍成功!");
									break;

								case 2:
									alert("退出此队伍成功!");
									break;

								case 3:
									alert("解散此队伍成功!");
									break;

								case 4:
									alert("变更保存成功!");
									break;

								case 5:
									alert("队伍创建成功!");
									break;

								case 6:
									alert("item添加成功!");
									break;

								case 7:
									alert("circle添加成功!");
									break;

								case 8:
									alert("成功将该circle设置为已完成/未完成!");
									break;

								case 9:
									alert("成功设置此用户为负责人!");
									break;
								case 10:
									alert("编辑item成功!");
									break;
							}
						} else if (type_number == 0) {
							switch (text_number) {
								case 1:
									alert("加入此队伍失败.请确认密码!");
									break;

								case 2:
									alert("未知错误,退出此队伍失败.\n请刷新或者重新登录之后再试!");
									break;

								case 3:
									alert("未知错误,解散此队伍失败.\n请刷新或者重新登录之后再试!");
									break;

								case 4:
									alert("未知错误,变更保存失败.\n请不要尝试输入过于奇怪的字符或刷新之后再试!");
									break;
								case 5:
									alert("队伍创建失败.\n请检查是否重名或者使用汉字/英文字母的队伍名!");
									break;

								case 6:
									alert("item添加失败.\n1.请检查当前活跃队伍中的列表中是否不存在此circle!\n若不存在,请先添加circle!\n2.请检查当前活跃队伍中的列表中是否已存在此item名!\n若已存在,请更换item名!");
									break;

								case 7:
									alert("circle添加失败.\n请检查当前活跃队伍中的列表中是否已存在此circle!\n若已存在,则不必再次添加!");
									break;

								case 8:
									alert("将该circle设置为已完成/设置为未完成失败!请检查circle或队伍是否已被删除!");
									break;

								case 9:
									alert("设置此用户为负责人失败!请检查此人是否已经退出队伍!");
									break;

								case 10:
									alert("编辑item失败!请刷新查看此item是否已被删除!");
									break;

							};
						};
					});

					//掉线
					socket.on("disconnect", function() {
						$("#recived_message").append("<br><li><center>连接异常关闭</center></li>");
						console.log("与服务器的连接已关闭.刷新页面以重新连接.");
						$("#connect_flag").empty().append("消息(连接已断开)");
						$("#message").page();
						$("#recived_message").listview("refresh");
					}); //socket.on("disconnect", function() ending

				}); //socket.on("connect") ending




				//消息发送机能
				$("#sent_message").keypress(function(event) {
					if (event.which == 13) {
						event.preventDefault();
						socket.emit("main_message_server", localStorage.nickname + ":" + $("#sent_message").val());
						$("#recived_message").append("<li><div class=\"scroll\">" + localStorage.nickname + ":" + $("#sent_message").val() + "</div></li>");
						$("#recived_message").listview("refresh");
						$("#sent_message").val("");
					}; //if ending
				}); //$("#sent_message").keypress(function(event) ending

				$("#button_message_send").click(function() {
					socket.emit("main_message_server", localStorage.nickname + ":" + $("#sent_message").val());
					$("#recived_message").append("<li><div class=\"scroll\">" + localStorage.nickname + ":" + $("#sent_message").val() + "</div></li>");
					$("#recived_message").listview("refresh");
					$("#sent_message").val("");
				}); //$("#button_message_send").click(function() ending
				//清除消息
				$("#button_message_clear").click(function() {
					$("#recived_message").empty();
					$("#recived_message").append("<li><center><h1>对话消息</h1></center></li>");
					if (is_connected) {
						$("#recived_message").append("<li><center>连接成功<center></li>");
					};
					$("#recived_message").listview("refresh");

				}); //$("#button_message_clear").click() ending
				//CSV上传
				$("#upload_csv").click(function() {
					var r = confirm("确认为\"" + localStorage.active_group + "\"上传CSV?");
					if (r) {
						if (window.csvdata != "") {
							$("#upload_result").empty();
							console.log("上传开始");
							for (var pointer = 0; pointer < window.csvdata.length; pointer++) {
								switch (window.csvdata[pointer][0]) {
									case "Circle":
										socket.emit("main_csv_submit_server", window.csvdata[pointer], localStorage.active_group);//修改点2
										break;

									case "Header":
										break;

										case "Color":
										break;

									default:
										console.log(pointer);
										if (pointer + 1 == window.csvdata.length && window.csvdata[pointer].length == 1) { //	行尾空格,不报错.
										} else {
											$("#upload_result").append("<li><div class=\"scroll\">错误:" + window.csvdata[pointer] + "</div></li>");
										};
										break;
								};
							};
						} else {
							alert("请选择文件");
						};
					};
				}); //刷新与数据获取
				$("#refresh_data").click(function() {
					if (localStorage.active_group) {
						$("#unfinished").empty();
						$("#finished").empty();
						$("#all_mission").empty(); //载入新数据之前清空旧数据
						$("#unfinished_count").text(0);
						$("#finished_count").text(0);
						$("#all_count").text(0);
						socket.emit("main_mission_list_server", localStorage.nickname, localStorage.active_group);
					} else {
						alert("尚未选择活跃队伍~");
					};
				});
				//上传edit后的数据
				$("#items_edit_save").click(function() {
					if ($("#items_edit_target").val() && $("#items_edit_bought").val() && $("#items_edit_price").val()) {
						var edit_data_obj = new Object();
						edit_data_obj = {
							"bought": Number($("#items_edit_bought").val()),
							"target": Number($("#items_edit_target").val())
						};
						var edit_data_string = JSON.stringify(edit_data_obj);
						//						console.log("对象字符串化为" + edit_data_string);
						var edit_price_number = Number($("#items_edit_price").val());
						socket.emit("main_edit_data_server", edit_data_string, edit_price_number, $("#items_edit_name").val(), $("#items_edit_username").val(), localStorage.active_group);
					} else {
						alert("请完成所有表单!");
					};
				});

				//最终结算
				$("#calc_start").click(function() {
					window.calc_data.spend_count = 0;
					window.calc_data.income_count = 0;
					window.calc_data.outcome_count = 0; // 初始化三个count变量

					$("#calc_result_income_count").text("应收小计:0円");
					$("#calc_result_spend_count").text("消费小计:0円");
					$("#calc_result_outcome_count").text("应付小计:0円");

					$("#calc_result_spend").empty().append("<li><div class=\"scroll\">" + "自身购买的宝物" + "</div></li>");
					$("#calc_result_spend_simple").empty().append("<li><div class=\"scroll\">" + "自身消费的简明清单" + "</div></li>");

					$("#calc_result_income").empty().append("<li><div class=\"scroll\">" + "收入情况-由自己代购的宝物" + "</div></li>");
					$("#calc_result_income_simple").empty().append("<li><div class=\"scroll\">" + "简明收款指南" + "</div></li>");

					$("#calc_result_outcome").empty().append("<li><div class=\"scroll\">" + "支出情况-由其他用户代购的宝物" + "</div></li>");
					$("#calc_result_outcome_simple").empty().append("<li><div class=\"scroll\">" + "简明付款指南" + "</div></li>");
					$("#calc_result").page();
					$("#calc_result_spend_simple").listview("refresh");
					$("#calc_result_income_simple").listview("refresh");
					$("#calc_result_outcome_simple").listview("refresh");

					if ($("#calc_when") != "233") {
						window.calc_data.date = $("#calc_when").val(); //暂时把结算的时间扔进去
					};
					socket.emit("main_calc_server", localStorage.nickname);
					$.mobile.changePage("#calc_result");
				});
				//代购详情跳转
				$("#turn_to_calc_result_details").click(function() {
					$("#calc_result_details").page();

					$("#calc_result_income").listview("refresh");
					$("#calc_result_outcome").listview("refresh");
					$("#calc_result_spend").listview("refresh");
				});

				///////////////第二期新增代码/////////////////

				$("#turn_to_select_group").click(function() {
					$("#recived_group").empty().append("<li><center><h1>所有的队伍</h1></center></li>");
					//清空队伍信息
					window.op_group["raw_all_group"] = [];
					window.op_group["all_group"] = [];
					window.op_group["my_group"] = [];
					socket.emit("main_select_group_server", localStorage.nickname);
				});

				$("#turn_to_manage_group").click(function() {
					is_turning = 0;
					socket.emit("main_manage_group_server", localStorage.nickname);
				});

				$("#manage_group_add_save").click(function() {
					window.op_group.add();
					$.mobile.changePage("#select_group");
				});

				$("#select_group_refresh").click(function() {
					$("#recived_group").empty().append("<li><center><h1>所有的队伍</h1></center></li>");
					//清空队伍信息
					window.op_group["raw_all_group"] = [];
					window.op_group["all_group"] = [];
					window.op_group["my_group"] = [];
					socket.emit("main_select_group_server", localStorage.nickname);
				});

				$("#button_join_group").click(function() {
					if ($("#group_details_change_group_password").val()) {
						socket.emit("main_op_group_server", localStorage.nickname, 1, window.op_group.now_group, $("#group_details_change_group_password").val(), "");
					} else {
						alert("请输入队伍密码!");
						$("#group_details_change_group_password").focus();
					};
				});

				$("#button_exit_group").click(function() {
					var r = confirm("你确定要退出此队伍?");
					if (r) {
						if (localStorage.active_group == window.op_group.now_group) {
							localStorage.active_group = "";
							$("#mission_title").text("未选择活跃队伍");
						};
						socket.emit("main_op_group_server", localStorage.nickname, 2, window.op_group.now_group, "", "", "");
					};
				});

				$("#button_delete_group").click(function() {
					var r1 = confirm("你确定要解散此队伍?");
					if (r1) {
						var r2 = confirm("真的要解散此队伍吗?所有的数据都会被永久删除!");
						if (r2) {
							socket.emit("main_op_group_server", localStorage.nickname, 3, window.op_group.now_group, "", "", "");
						};
					};
				});

				$("#turn_to_manage_group_add").click(function() {
					$("#manage_group_add_group_name").val("");
					$("#manage_group_add_group_introduction").val("");
					$("#manage_group_add_group_password").val("");
					$.mobile.changePage("#manage_group_add");
				});

				$("#group_details_save").click(function() {
					if ($("#group_details_change_group_name").val() && $("#group_details_change_group_password").val() && $("#group_details_change_group_introduction").val()) {
						socket.emit("main_op_group_server", localStorage.nickname, 4, window.op_group.now_group, $("#group_details_change_group_password").val(), $("#group_details_change_group_introduction").val(), $("#group_details_change_group_name").val());
					} else {
						alert("请填写所有的信息!");
					};
				});

				$("#button_active_group").click(function() {
					localStorage.active_group = window.op_group.now_group;
					localStorage.active_group_power = window.op_group.now_group_power;
					$("#mission_title").text(localStorage.active_group);
					alert("成功设置\"" + localStorage.active_group + "\"为活跃队伍");
					$("#button_active_group").button("disable").val("已设为活跃").button("refresh");
				});

				$("#turn_to_add_item").click(function() {
					if (localStorage.active_group) {
						$("#add_item").page();
						$("#add_item_name").val("");
						$("#add_item_price").val("");
						$("#add_item_number").val("");
						$("#add_item_copy_num").val(1).slider("refresh");
						$.mobile.changePage("#add_item");
					} else {
						alert("请选择活跃队伍!");
					};
				});

				$("#add_item_reset").click(function() {
					var r = confirm("确认重置这个表单?");
					if (r) {
						$("#add_item_name").val("");
						$("#add_item_price").val("");
						$("#add_item_number").val("");
						$("#add_item_copy_num").val(1).slider("refresh");
					};
				});

				$("#add_item_upload").click(function() {
					var r = confirm("确认为" + localStorage.active_group + "添加item?");
					if (r) {
						if ($("#add_item_name").val() && $("#add_item_price").val() && $("#add_item_number").val() && $("#add_item_copy_num").val() && $("#add_item_responsibility").val()) {
							if ($("#add_item_number").val().length == 6) {
								socket.emit("main_add_item_server", $("#add_item_name").val(), $("#add_item_price").val(), $("#add_item_number").val(), $("#add_item_copy_num").val(), localStorage.nickname, localStorage.active_group, $("#add_item_responsibility").val());
							} else {
								alert("请确认circle id是否正确!");
							};
						} else {
							alert("请填写所有的信息!");
						};
					};
				});

				$("#turn_to_add_circle").click(function() {
					if (localStorage.active_group) {
						$("#add_circle").page();
						$("#add_circle_which_day").val("日").selectmenu("refresh");
						$("#add_circle_area").val("東").selectmenu("refresh");
						$("#add_circle_block_name").val("");
						$("#add_circle_space_number").val("");
						$("#add_circle_name").val("");
						$("#add_circle_number").val("");
						$("#add_circle_rank").val("");
						$("#add_circle_author").val("");
						$.mobile.changePage("#add_circle");
					} else {
						alert("请选择活跃队伍!");
					};
				});

				$("#add_circle_reset").click(function() {
					var r = confirm("确认重置这个表单?");
					if (r) {
						$("#add_circle_which_day").val("日").selectmenu("refresh");
						$("#add_circle_area").val("東").selectmenu("refresh");
						$("#add_circle_block_name").val("");
						$("#add_circle_space_number").val("");
						$("#add_circle_name").val("");
						$("#add_circle_number").val("");
						$("#add_circle_rank").val("");
						$("#add_circle_author").val("");
					};
				});

				$("#add_circle_upload").click(function() {
					var r = confirm("确认为队伍\"" + localStorage.active_group + "\"添加circle?");
					if (r) {
						if ($("#add_circle_which_day").val() && $("#add_circle_area").val() && $("#add_circle_block_name").val() && 　$("#add_circle_space_number").val() && $("#add_circle_name").val() && $("#add_circle_number").val() && $("#add_circle_rank").val() && $("#add_circle_author").val()) {
							if ($("#add_circle_number").val().length == 6) {
								// socket.emit("main_add_circle_server", $("#add_circle_which_day").val(), $("#add_circle_area").val(), $("#add_circle_number").val(), $("#add_circle_block_name").val(), $("#add_circle_space_number").val(), $("#add_circle_name").val(), $("#add_circle_rank").val(), $("#add_circle_author").val(), localStorage.nickname, localStorage.active_group);
								socket.emit("main_add_circle_server", $("#add_circle_which_day").val(), $("#add_circle_area").val(), $("#add_circle_number").val(), $("#add_circle_block_name").val(), $("#add_circle_space_number").val(), $("#add_circle_name").val(), $("#add_circle_rank").val(), $("#add_circle_author").val(), localStorage.active_group);//"修改点1"
							} else {
								alert("请确认サークルシリアル番号是否正确!");
							};
						} else {
							alert("请填写所有的信息!");
						};
					};
				});

				$("#circle_details_set_finished").click(function() {
					if ($("#circle_details_set_finished").val() == "设为已完成") {
						var r = confirm("确认将circle" + window.op_details.now_circleid + "设为已完成?");
						if (r) {
							socket.emit("main_circle_finish_server", 1, window.op_details.now_circleid, localStorage.active_group);
						};
					} else {
						var r = confirm("确认将circle" + window.op_details.now_circleid + "设为未完成?");
						if (r) {
							socket.emit("main_circle_finish_server", 0, window.op_details.now_circleid, localStorage.active_group);
						};
					};
				});

				// $("#circle_details_responsibility").change(function() {
				// 	$("#circle_details_responsibility").selectmenu("refresh");
				// 	socket.emit("main_change_responsibility_server", $("#circle_details_responsibility").val(), window.op_details.now_circleid, localStorage.active_group);
				// });

//11.12修改原版备份

//修改点3开始
				$("#item_select_responsibility").change(function() {
					$("#item_select_responsibility").selectmenu("refresh");
					socket.emit("main_change_responsibility_server", $("#item_select_responsibility").val(), window.op_details.now_itemname, localStorage.active_group);
				});
				//修改window.op_details.now_circleid为window.op_items.now_itemname
//修改点3结束


				$("#items_edit_select_assure").click(function() {
					if ($("#items_for_select").val() && $("#user_for_select").val()) {
						var pureobj_info = eval('(' + window.op_details.otherinfo[window.op_items.now_circleid][$("#items_for_select").val()][$("#user_for_select").val()] + ')');
						
						window.op_items.now_itemname = $("#items_for_select").val();//11.12

						$("#items_edit_name").val("").val(window.op_details.otherinfo[window.op_items.now_circleid][$("#items_for_select").val()]['item_name'])
						$("#items_edit_username").val($("#user_for_select").val());
						$("#items_edit_price").val("").val(window.op_details.otherinfo[window.op_items.now_circleid][$("#items_for_select").val()]['item_price']);

						$("#items_edit_target").val("");
						$("#items_edit_bought").val("");

                        //goal1：在这里对 #item_select_responsibility 进行队伍中人员的append，可能在op_details里有成员表

						if (pureobj_info != null) {
							$("#items_edit_target").val(pureobj_info['target']);
							$("#items_edit_bought").val(pureobj_info['bought']);
						};

						$.mobile.changePage("#items_edit");
					} else {
						alert("请选择item和user!");
					};
				});

			}); //$(function) ending
		</script>

	</head>

	<body>



		<div data-role="page" id="mission">
			<div data-role="header" data-position="fixed">
				<h1 id="mission_title">任务</h1>
				<div data-role="button" class="ui-btn-right">
					<a href="#tools" data-role="button" data-icon="grid" data-transition="slide">工具</a>
				</div>
				<div data-role="button" class="ui-btn-left">
					<input type="button" id="refresh_data" data-icon="refresh" value="刷新">
				</div>
			</div>

			<div data-role="content">

				<div data-role="collapsible" data-collapsed="false">
					<h4>未完成的任务<span id="unfinished_count" class="ui-li-count">0</span></h4>
					<ul id="unfinished" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="在未完成的任务中搜索..."></ul>
				</div>

				<div data-role="collapsible">
					<h4>已完成的任务<span id="finished_count" class="ui-li-count">0</span></h4>
					<ul id="finished" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="在已完成的任务中搜索..."></ul>
				</div>

				<div data-role="collapsible">
					<h4>队伍全部circle<span id="all_count" class="ui-li-count">0</span></h4>
					<ul id="all_mission" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="在全部任务中搜索..."></ul>
				</div>

			</div>

			<div data-role="footer" data-position="fixed">
				<div data-role="navbar" id="shift_to_message">
					<ul>
						<li><a href="#" data-icon="info" class="ui-state-persist">任务</a>
						</li>
						<li><a id="turn_to_message" href="#message" data-icon="star" data-transition="fade">消息</a>
					</ul>
				</div>
			</div>
		</div>

		<div data-role="page" id="message">
			<div data-role="header">
				<h1 id="connect_flag">消息</h1>
				<div data-role="button" class="ui-btn-left">
					<input type="button" id="button_message_clear" value="清空" data-role="button" data-icon="alert">
				</div>
			</div>

			<div data-role="content">
				<ul id="recived_message" data-role="listview" data-inset="false" data-filter-placeholder="搜索消息记录...">
					<li>
						<center>
							<h1>对话消息</h1>
						</center>
					</li>
				</ul>
				<br>
				<input type="text" id="sent_message">
				<input type="button" id="button_message_send" value="发送消息">
				<br>


			</div>

			<div data-role="footer" data-position="fixed">
				<div data-role="navbar" id="shift_to_mission">
					<ul>
						<li><a href="#mission" data-icon="info" data-transition="fade">任务</a>
						</li>
						<li><a href="#" data-icon="star" class="ui-state-persist">消息</a>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<div data-role="page" id="tools">
			<div data-role="header">
				<h1>工具</h1>
				<a href="#mission" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>
				<a href="http://test.eshicon.org/login.html" onclick="localStorage.clear()" data-role="button" data-icon="minus">退出当前帐号</a>

			</div>

			<div data-role="content">
				<input type="button" id="turn_to_select_group" value="队伍管理">
				<input type="button" id="turn_to_add_item" value="登录新物品">
				<input type="button" id="turn_to_add_circle" value="登录新摊位">
				<a href="#input_csv" data-role="button" data-transition="slide">导入CSV文件</a>
				<br>
				<hr>
				<br>
				<a href="#calc_setting" data-role="button">结算</a>
				<a href="#about" data-role="button" data-transition="slide">关于</a>
			</div>
		</div>

		<div data-role="page" id="select_group">
			<div data-role="header">
				<h1>队伍选择的时刻</h1>

				<div data-role="button" class="ui-btn-left">
					<a href="#tools" data-role="button" data-icon="back" data-direction="reverse" data-transition="slide">返回</a>
				</div>

				<div data-role="button" class="ui-btn-right">
					<input type="button" id="select_group_refresh" value="刷新" data-icon="alert">
				</div>
			</div>

			<div data-role="content">
				<ul id="recived_group" data-role="listview" data-inset="true" data-filter="true" data-filter-placeholder="搜索队伍...">
					<li>
						<center>
							<h1>所有的队伍</h1>
						</center>
					</li>
				</ul>
			</div>

			<div data-role="footer" data-position="fixed">
				<div data-role="navbar">
					<ul>
						<li><a id="turn_to_manage_group_add" data-icon="info" class="ui-btn">创建新队伍!</a>
						</li>
					</ul>
				</div>
			</div>

		</div>

		<div data-role="page" id="group_details">
			<div data-role="header">
				<h1>队伍详情</h1>

				<div data-role="button" class="ui-btn-left">
					<a href="#select_group" data-role="button" data-icon="back" data-direction="reverse" data-transition="slide">返回</a>
				</div>

				<div data-role="button" class="ui-btn-right">
					<input type="button" id="group_details_save" value="保存更改" data-icon="alert" disabled>
				</div>
			</div>

			<div data-role="content">
				<div data-role="fieldcontain">
					<label for="group_details_change_group_name">队伍名:</label>
					<input type="text" name="name" id="group_details_change_group_name" value="" placeholder="队伍的名字" readonly>
				</div>

				<div data-role="fieldcontain">
					<label for="group_details_change_group_introduction">队伍介绍:</label>
					<input type="text" id="group_details_change_group_introduction" value="" placeholder="随便写点吧" readonly>
				</div>

				<div data-role="fieldcontain">
					<label for="group_details_change_group_password">密码:</label>
					<input type="text" id="group_details_change_group_password" value="" placeholder="输入/变更密码" readonly>
				</div>

				<div data-role="fieldcontain">
					<label for="group_details_change_group_my_power">你的权限:</label>
					<input type="text" name="text" id="group_details_change_group_my_power" value="" placeholder="" readonly>
				</div>

				<ul id="group_members" data-role="listview" data-inset="true">
					<li>
						<center>
							<h1>队伍成员</h1>
						</center>
					</li>
				</ul>



				<input type="button" id="button_active_group" value="设为活跃" disabled>
				<input type="button" id="button_join_group" value="加入此队伍" disabled>
				<input type="button" id="button_exit_group" value="退出此队伍" disabled>
				<input type="button" id="button_delete_group" value="解散此队伍" disabled>
			</div>

		</div>

		<div data-role="page" id="manage_group_add">
			<div data-role="header">
				<h1>创建新队伍</h1>
				<div data-role="button" class="ui-btn-left">
					<a href="#select_group" data-role="button" data-icon="back" data-direction="reverse" data-transition="slide">返回</a>
				</div>

				<div data-role="button" class="ui-btn-right">
					<input type="button" id="manage_group_add_save" value="保存" data-icon="alert">
				</div>
			</div>

			<div data-role="content">

				<div data-role="fieldcontain">
					<label for="name">队伍名:</label>
					<input type="text" name="name" id="manage_group_add_group_name" value="" placeholder="队伍的名字">
				</div>

				<div data-role="fieldcontain">
					<label for="text">队伍介绍:</label>
					<input type="text" name="text" id="manage_group_add_group_introduction" value="" placeholder="随便写点吧">
				</div>

				<div data-role="fieldcontain">
					<label for="password">密码:</label>
					<input type="text" name="text" id="manage_group_add_group_password" value="" placeholder="加入队伍时所需要的密码">
				</div>

			</div>

		</div>

		<div data-role="page" id="add_item">
			<div data-role="header">
				<h1>登录新的宝物</h1>
				<a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>
				<div data-role="button" class="ui-btn-right">
					<input type="button" id="add_item_reset" value="重置" data-role="button" data-icon="alert" class="ui-btn-right">
				</div>
			</div>

			<div data-role="content">
				<div data-role="fieldcontain">
					<label for="add_item_name">item名</label>
					<input type="text" id="add_item_name" value="" placeholder="宝物的名字">
				</div>

				<div data-role="fieldcontain">
					<label for="add_item_price">价格</label>
					<input type="text" id="add_item_price" value="" placeholder="円/份">
				</div>

				<div data-role="fieldcontain">
					<label for="add_item_place_number">サークルシリアル番号</label>
					<input type="text" id="add_item_number" value="" placeholder="circle的序列号">
				</div>

				<div data-role="fieldcontain">
					<label for="add_item_copy_num">自身需求份数</label>
					<input type="range" id="add_item_copy_num" value="1" min="1" max="30">
				</div>

				<div data-role="fieldcontain">
					<label for="add_item_responsibility">item负责人</label>
					<input type="text" id="add_item_responsibility">
				</div>



				<input type="button" id="add_item_upload" value="上传信息" />

			</div>

		</div>

		<div data-role="page" id="add_circle">
			<div data-role="header">
				<h1>登录新摊位</h1>
				<a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>
				<div data-role="button" class="ui-btn-right">
					<input type="button" id="add_circle_reset" value="重置" data-role="button" data-icon="alert" class="ui-btn-right">
				</div>
			</div>

			<div data-role="content">

				<fieldset data-role="fieldcontain">
					<label for="add_circle_which_day">参加曜日</label>
					<select id="add_circle_which_day" data-native-menu="false">
						<option value="日">第一天 日曜日</option>
						<option value="月">第二天 月曜日</option>
						<option value="火">第三天 火曜日</option>
					</select>
				</fieldset>

				<fieldset data-role="fieldcontain">
					<label for="add_circle_area">配置地区</label>
					<select id="add_circle_area" data-native-menu="false">
						<option value="東">東</option>
						<option value="西">西</option>
					</select>
				</fieldset>

				<div data-role="fieldcontain">
					<label for="add_circle_block_name">ブロック名</label>
					<input type="text" id="add_circle_block_name" value="" placeholder="A~Z/ア~ロ/あ～れ">
				</div>

				<div data-role="fieldcontain">
					<label for="add_circle_space_number">スペース番号</label>
					<input type="text" id="add_circle_space_number" value="" placeholder="space序号">
				</div>

				<div data-role="fieldcontain">
					<label for="add_circle_name">サークル名</label>
					<input type="text" id="add_circle_name" value="" placeholder="circle的名字">
				</div>

				<div data-role="fieldcontain">
					<label for="add_circle_number">サークルシリアル番号</label>
					<input type="text" id="add_circle_number" value="" placeholder="circle序列号">
				</div>


				<div data-role="fieldcontain">
					<label for="add_circle_rank">カットインデックス</label>
					<input type="text" id="add_circle_rank" value="" placeholder="摊位优先级">
				</div>

				<div data-role="fieldcontain">
					<label for="add_circle_author">執筆者名</label>
					<input type="text" id="add_circle_author" value="" placeholder="执笔者的名字">
				</div>
				<input type="button" id="add_circle_upload" value="上传信息" />

			</div>

		</div>

		<div data-role="page" id="input_csv">
			<div data-role="header">
				<h1>导入CSV</h1>
				<a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>
				<div data-role="button" class="ui-btn-right">
					<input type="button" id="upload_csv" value="上传" data-icon="arrow-u">
				</div>
			</div>

			<div data-role="content">

				<form id="form_upload_csv">
					<label for="csvFileInput">
						<strong>CSV File:</strong>
					</label>
					<input type="file" id="csvFileInput" onchange="handleFiles(this.files)" accept=".csv">
				</form>
				<center><a href="https://github.com/suica/KJ-PROJECT/wiki/%E5%A6%82%E4%BD%95%E5%AF%BC%E5%85%A5CSV%EF%BC%9F">务必要看!详细的上传帮助!(好像有点过时了,10-5书)</a>
				</center>
				<center>～上传之前请转换为UTF-8编码上传,否则产生乱码!～</center>
				<center>～请不要修改CSV文件的内容,直接上传即可～</center>
				<center>～建议使用chrome for windows～</center>

				<br>
				<ul id="upload_result" data-role="listview" data-inset="true"></ul>
			</div>

		</div>

		<div data-role="page" id="circle_details">
			<div data-role="header">
				<h1>circle详情</h1>
				<a href="#mission" data-role="button" data-icon="back" data-transition="fade">返回</a>
			</div>

			<div data-role="content">
				<ul id="circle_details_circledata" data-role="listview" data-inset="true"></ul>
				<ul id="circle_details_otherinfo" data-role="listview" data-inset="true"></ul>
				<input type="button" id="circle_details_set_finished" value="设为已完成" disabled="" />
<!-- 				<select id="circle_details_responsibility" data-native-menu="false" disabled="">
					<option value="">请选择负责人</option>
				</select>
 -->				
 				<input type="button" value="从队伍里永久删除此circle" />

			</div>
		</div>

		<div data-role="page" id="items">
			<div data-role="header">
				<h1>items</h1> 
				<a href="#mission" data-role="button" data-icon="back">返回</a>
			</div>

			<div data-role="content">
				<ul id="items_list" data-role="listview" data-inset="true">
				</ul>
			</div>

			<div data-role="footer" data-position="fixed">
				<div data-role="navbar">
					<ul>
						<li>
							<a href="#items_edit_select" data-rel="dialog" data-icon="info" class="ui-btn" onclick="window.op_items.clear_selectmemu()">编辑</a>
						</li>
					</ul>
				</div>
			</div>
		</div>

		<div data-role="page" id="items_edit_select">
			<div data-role="content">
				<br />
				<br />
				<br />
				<select id="items_for_select" data-native-menu="false">
				</select>
				<br />
				<select id="user_for_select" data-native-menu="false">
				</select>
				<br />
				<br />
				<br />

				<div class="ui-grid-a">
					<div class="ui-block-a">
						<a href="#items" data-role="button">取消</a>
					</div>
					<div class="ui-block-b">
						<input id="items_edit_select_assure" type="button" value="确认" />
					</div>
				</div>

				<br />
				<br />

			</div>
		</div>


		<div data-role="page" id="items_edit">
			<div data-role="header">
				<h1>编辑</h1>
				<a href="#items_edit_select" data-rel="dialog" data-role="button" data-icon="back" onclick="window.op_items.clear_selectmemu()">返回</a>
				<div data-role="button" class="ui-btn-right">
					<input type="button" id="items_edit_save" value="保存" data-icon="alert">
				</div>
			</div>

			<div data-role="content">

				<div data-role="fieldcontain">
					<label for="items_edit_name">item名(无法修改)</label>
					<input type="text" id="items_edit_name" value="" readonly="">
				</div>
				<div data-role="fieldcontain">
					<label for="items_edit_username">user名</label>
					<input type="text" id="items_edit_username" value="" readonly="">
				</div>
				<div data-role="fieldcontain">
					<label for="items_edit_price">价格:円</label>
					<input type="text" id="items_edit_price" value="" placeholder="勿恶意更改价格">
				</div>
				<div data-role="fieldcontain">
					<label for="items_edit_target">自身目标数:</label>
					<input type="text" id="items_edit_target" value="" placeholder="必填">
				</div>
				<div data-role="fieldcontain">
					<label for="items_edit_bought">已经获得数:</label>
					<input type="text" id="items_edit_bought" value="" placeholder="必填">
				</div>

				<select id="item_select_responsibility" data-native-menu="false">
					<option value="">请选择负责人</option>
				</select>

				<input type="button" value="对所有人删除此item" />

			</div>

		</div>

		<div data-role="page" id="calc_setting">
			<div data-role="header">
				<h1>结算设置</h1>
				<a href="#tools" data-role="button" data-icon="back">返回</a>
			</div>

			<div data-role="content">

				<div data-role="fieldcontain">
					<label for="calc_when">
						<center>结算哪天的?</center>
					</label>
					<br>
					<select name="calc_when" id="calc_when" data-native-menu="false">
						<option value="金">8.15 (金)</option>
						<option value="土">8.16 (土)</option>
						<option value="日">8.17 (日)</option>
						<option value="233">全部三天</option>
					</select>
				</div>

				<input type="button" id="calc_start" value="开始结算!">

			</div>

		</div>

		<div data-role="page" id="calc_result">
			<div data-role="header">
				<h1>结算结果</h1>
				<a href="#tools" data-role="button" data-icon="back">返回</a>
				<a id="turn_to_calc_result_details" href="#calc_result_details" data-role="button" data-icon="star">代购关系详情</a>
			</div>

			<div data-role="content">

				<ul id="calc_result_spend_simple" data-inset="true" data-role="listview">
					<li>
						<div class="scroll">自身消费的简明清单</div>
					</li>
				</ul>
				<ul id="calc_result_outcome_simple" data-inset="true" data-role="listview">
					<li>
						<div class="scroll">简明付款指南</div>
					</li>
				</ul>
				<ul id="calc_result_income_simple" data-inset="true" data-role="listview">
					<li>
						<div class="scroll">简明收款指南</div>
					</li>
				</ul>
			</div>
		</div>

		<div data-role="page" id="calc_result_details">
			<div data-role="header">
				<h1>代购关系详情</h1>
				<a href="#calc_result" data-role="button" data-icon="back">返回</a>
			</div>

			<div data-role="content">
				<ul id="calc_result_spend" data-inset="true" data-role="listview">
					<li>
						<div class="scroll">自身购买的宝物</div>
					</li>
				</ul>
				<ul data-inset="true" data-role="listview">
					<li id="calc_result_spend_count">消费小计</li>
				</ul>

				<ul id="calc_result_outcome" data-inset="true" data-role="listview">
					<li>
						<div class="scroll">支出情况-由其他用户代购的宝物</div>
					</li>
				</ul>
				<ul data-inset="true" data-role="listview">
					<li id="calc_result_outcome_count">应付小计</li>
				</ul>

				<ul id="calc_result_income" data-inset="true" data-role="listview">
					<li>
						<div class="scroll">收入情况-由自己代购的宝物</div>
					</li>
				</ul>
				<ul data-inset="true" data-role="listview">
					<li id="calc_result_income_count">应收小计</li>
				</ul>


			</div>

		</div>

		<div data-role="page" id="about">
			<div data-role="header">
				<h1>关于</h1>
				<div data-role="button" class="ui-btn-left">
					<a href="#tools" data-role="button" data-icon="back" data-transition="slide" data-direction="reverse">返回</a>
				</div>
			</div>

			<div data-role="content">
				<center>ver 2.1</center>
				<center>「升级版」</center>
				<br>
				<hr>
				<br>
				<br>
				<br>
				<center>code by suica</center>
				<br>
				<center>感谢:</center>
				<center>Katsuragi Mikoto 的帮助</center>
				<center>Testarossa 的意见</center>
				<center>和其他所有给我帮助的各位!</center>
			</div>
		</div>

	</body>

</html>